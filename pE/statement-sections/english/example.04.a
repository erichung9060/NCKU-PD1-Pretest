O(nnmq+nnmq+a+r)
